import React,{useEffect,useState}from'react';import{ScrollView,View,Text,TextInput,Alert}from'react-native';import{db}from'@/db/sqlite';import{store,mem}from'@/utils/webStore';import{generateRecipe}from'@/services/ai';import HapticPress from '@/components/HapticPress';export default function Menu(){const[idea,setIdea]=useState('');const[title,setTitle]=useState('');const[ingredients,setIngredients]=useState('[]');const[steps,setSteps]=useState('');const[list,setList]=useState<any[]>([]);const database=db();const load=async()=>{if(!database){setList(mem.recipes);return;}const rows=await database.getAllAsync?.('SELECT * FROM recipes ORDER BY id DESC');setList(rows||[])};useEffect(()=>{load();},[]);const generate=async()=>{const r=await generateRecipe({idea});setTitle(title||'Новый рецепт');setIngredients(JSON.stringify(r.ingredients,null,2));setSteps(r.steps)};const save=async()=>{if(!title){Alert.alert('Введите название');return;}if(!database){store.addRecipe({title,ingredients_json:ingredients,steps_md:steps});setTitle('');setIngredients('[]');setSteps('');setList(mem.recipes);return;}await database.runAsync?.('INSERT INTO recipes(title,ingredients_json,steps_md) VALUES (?,?,?)',[title,ingredients,steps]);setTitle('');setIngredients('[]');setSteps('');load()};return(<ScrollView style={{padding:16,backgroundColor:'#fff'}}><Text style={{fontSize:22,fontWeight:'700'}}>Меню / ТТК</Text><TextInput placeholder='Идея' value={idea} onChangeText={setIdea} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><View style={{flexDirection:'row',marginTop:8,gap:8 as any}}><HapticPress style={{padding:10,backgroundColor:'#3A5F0B',borderRadius:10}} onPress={generate}><Text style={{color:'#fff'}}>ИИ → ТТК</Text></HapticPress></View><TextInput placeholder='Название' value={title} onChangeText={setTitle} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><TextInput placeholder='Ингредиенты (JSON)' value={ingredients} onChangeText={setIngredients} multiline numberOfLines={6} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8,fontFamily:'monospace'}}/><TextInput placeholder='Шаги (Markdown)' value={steps} onChangeText={setSteps} multiline numberOfLines={6} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><View style={{height:8}}/><HapticPress style={{padding:10,backgroundColor:'#8B1E2D',borderRadius:10,alignItems:'center'}} onPress={save}><Text style={{color:'#fff'}}>Сохранить ТТК</Text></HapticPress>{list.map(i=>(<View key={i.id||i.title} style={{borderWidth:1,borderColor:'#e5e7eb',borderRadius:12,padding:12,marginTop:8}}><Text style={{fontWeight:'700'}}>{i.title}</Text><Text numberOfLines={3}>{i.steps_md}</Text></View>))}<View style={{height:40}}/></ScrollView>) }