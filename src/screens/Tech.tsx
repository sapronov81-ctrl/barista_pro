import React,{useEffect,useState}from'react';import{ScrollView,View,Text,TextInput,Alert}from'react-native';import{db}from'@/db/sqlite';import{store,mem}from'@/utils/webStore';import{recommendMaintenance}from'@/services/ai';import HapticPress from '@/components/HapticPress';export default function Tech(){const[cafe,setCafe]=useState('');const[name,setName]=useState('');const[serial,setSerial]=useState('');const[state,setState]=useState('OK');const[list,setList]=useState<any[]>([]);const[reco,setReco]=useState<any[]>([]);const database=db();const load=async()=>{if(!database){setList(mem.equipment);return;}const rows=await database.getAllAsync?.('SELECT * FROM equipment ORDER BY id DESC');setList(rows||[])};useEffect(()=>{load();},[]);const add=async()=>{if(!cafe||!name){Alert.alert('Укажи кафе и имя');return;}if(!database){store.addEquip({cafe,name,serial,state});setList(mem.equipment);setCafe('');setName('');setSerial('');return;}await database.runAsync?.('INSERT INTO equipment(cafe,name,serial,state) VALUES (?,?,?,?)',[cafe,name,serial,state]);setCafe('');setName('');setSerial('');load()};const calculate=async()=>{setReco(await recommendMaintenance({equipment:list}))};return(<ScrollView style={{padding:16,backgroundColor:'#fff'}}><Text style={{fontSize:22,fontWeight:'700'}}>Техника/ТО</Text><TextInput placeholder='Кафе' value={cafe} onChangeText={setCafe} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><TextInput placeholder='Оборудование' value={name} onChangeText={setName} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><TextInput placeholder='Серийный' value={serial} onChangeText={setSerial} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><TextInput placeholder='Состояние' value={state} onChangeText={setState} style={{borderWidth:1,borderColor:'#ccc',borderRadius:8,padding:10,marginTop:8}}/><View style={{height:8}}/><HapticPress style={{padding:10,backgroundColor:'#8B1E2D',borderRadius:10,alignItems:'center'}} onPress={add}><Text style={{color:'#fff'}}>Добавить</Text></HapticPress><View style={{height:8}}/><HapticPress style={{padding:10,backgroundColor:'#3A5F0B',borderRadius:10,alignItems:'center'}} onPress={calculate}><Text style={{color:'#fff'}}>Рекомендации ИИ</Text></HapticPress>{reco.length>0?(<View style={{borderWidth:1,borderColor:'#e5e7eb',borderRadius:12,padding:12,marginTop:12}}>{reco.map((r,i)=>(<Text key={i}>• [{r.priority}] {r.task} ({r.cost})</Text>))}</View>):null}{list.map((e:any)=>(<View key={e.id||e.serial||e.name} style={{borderWidth:1,borderColor:'#e5e7eb',borderRadius:12,padding:12,marginTop:8}}><Text style={{fontWeight:'700'}}>{e.name}</Text><Text>{e.cafe} · {e.serial} · {e.state}</Text></View>))}<View style={{height:40}}/></ScrollView>) }